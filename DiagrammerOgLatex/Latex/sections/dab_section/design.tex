% !TeX root = ../../Handin4.tex

\section{Design}

Der er til denne løsning benyttet 1 NoSQL-database og 2 SQL-databaser for at overholde kravet om mindst 1 af hver jf. kravsspec.

Gruppen har valgt at lade Traderdatabasen være NoSQL, da dokumentdatabasen blev vurderet som den mest fleksible, idet den ikke er så låst fast som SQL-databaserne.

I forhold til den indledende fase og design har gruppen ikke valgt at bruge et ERD til at understøtte designet. Gruppen har i stedet i fællesskab tegnet systemet op i hånden og diskuteret, hvorledes klasserne og databaserne skulle opsættes. Det samme gjorde sig ligeledes gældende med Handin 3.2, del2, hvilket virkede fint.
Skulle man dog overdrage systemet til en anden udvikler eller skulle der ske hurtig refaktorering vil et ERD selvfølgelig være en fin hjælp at have. Og som med så mange andre diagrammer, styrker det forståelsen af det system som man arbejder med.

Gruppen har ligeledes hurtigt besluttet - med accept fra underviser Jesper Tørresø - at de 3 databaser ikke nødvendigvis skulle snakke sammen.
Dette er derfor ikke implementeret i systemet, men vil være en oplagt del at fokusere på i det fremtidige arbejde.

Den tekniske platform er udarbejdet på .NET Core med MVC- og Repository-pattern.
Der er benyttet Swagger til udarbejdelse af Rest-Api'er. Denne fremfor Postman, da gruppen har bedre erfaringer med Swagger.

Til gennemførelse af gruppens opgave er der taget stor inspiration fra medlemmernes løsning af Handin 3.2, del 1 og del 2.

\subsection{Domain Drive Design (DDD)}

I vores DDD har vi lavet 2 diagrammer, hvor der i det ene er vores Smartgrid og Prosumer, mens der i  den anden er vores Trader.

I det første diagram, SmartGrid er der 2 klasser, hhv. SmartGrid og SmartGridProsumer. SmartGrid indeholder udover en PK også information om den valgte smartgrid og hvor mange prosumers, der er.

SmartGridProsumers inderholder info omkring prosumers for hvem, der er i dette grid. Blandt andet deres InstallationsID og SmartMeterID.

I Prosumers findes ligeledes 2 klasser, hhv. Prosumers og ProsumersSmartMeterRecoresLog.
Den første indeholder udover et ProsumerID bl.a. info omkring total produktion og total forbrug af kWh-blokke. Den anden klasse indeholder tidsstemplede elementer med prosumerID for hver gang, der sendes data fra en given elmåler/smartmeter.
\insertfigure{../../../images/diagrammer/DDD-prosumer-grid/ddd-diagram-prosumer-grid.png}{1}{ddd}{Opstilling af DDD-diagram af ProsumerInfo og SmartGridInfo.}


I det andet diagram findes der nogle flere klasser, da det er en del mere kompleks. Vi vil i det følgende kort beskrive hver klasse:
\begin{itemize}

\item Trader: info omkring trader-delen ift. grid, total brug af kWh fra plant og hvis den er negativ viser den forbrug. Traderklassen er forbundet til de øvrige klasser, hvorfor der er et objekt eller en liste for hver enkelt af de øvrige klasser i databasen, hvor det har givet mening. Dette særligt, da der er tale om en dokumentdatabase.
\item ProsumerTraderInfo: Hver prosumers info omkring totalproduktion, profit og ”sellrate”.
\item CompletedTradesLog: En ny række for hver enkel handel for en given periode med køber, sælger og pris for, der er aftalt.
\item CurrentTrades: Igangværende trades, køberID, sælgerID samt antal kWh blokke og pris.
\item PlannedTrades: Fremtidige trades, køber- og sælgerID samt stamps fra og til og antal blokke.
\item ProsumerTradesSales: Liste over specielle tilbud fra en prosumer, det pågældende tidspunkt, antal blokke, bestemt af en tidsmarkør for hvornår folk kan købe til prisen. 
\item ProsumerTradesOffer: Indeholder prosumerID, antal blokke og deres pris.
\end{itemize}




    
\insertfigure{../../../images/diagrammer/DDD-trader/ddd-diagram-trader.png}{1}{ddd}{Opstilling af DDD-diagram af TraderInfo.}

